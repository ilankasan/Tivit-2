<!-- Full window overlay -->
<div id="activity-overlay"></div>

<!-- Add New Tivit Form -->
<!--
<div class="popup" id="add-tivit-window">

	<form action="/">
		<h3>Add a tivit for youself or for others</h3>
		<p><label for="tivit">tivit:</label><input type="text" id="tivit" /></p>
		<p><label for="who">Who:</label><input type="text" id="who" /></p>
		<p class="assign"><i></i> assign myself</p>
		<p><label for="what">What:</label><textarea id="what" cols="10" rows="10"></textarea></p>
		<p class="input-date"><label for="due">Needed by:</label>
		<input type="text" autocomplete="off" name="due" id="due" />
		<img class="ico_calc" onclick="javascript:NewCssCal('due', 'mmddyyyy', 'arrow')" src="images/cal.gif" alt="date" /></p>
		<div class="request">
			<div class="form-button" id="cancel">Cancel</div>
			<div class="form-button">Create</div>
		</div>
	</form>
	
	<div class="close" id="popup-close"></div>
</div>
-->

<div class="popup" id="add-tivit-window">

	<!-- Popup title -->
	<h3>Add a tivit for youself or for others</h3>

	<!-- in the form tag below, the second id is the actual HTML ID of the form which I use in jQuery -->
	<%= form_tag({:controller => "activities", :action => "create_tivit", :method => "post", :id => @activity.id}, :id => "create-new-tivit-form") do %>
	
		<!-- tivit name -->
		<!-- <p><label for="tivit">tivit:</label><input type="text" id="tivit" /></p> -->	
		<p><label for="tivit">tivit:</label>
			<%= text_field_tag(:name, nil) %> 
		</p>
		
		<!-- tivit invitee -->
		<!-- <p><label for="who">Who:</label><input type="text" id="who" /></p> -->
		<p><label for="who">Who:</label>
			<%= text_field_tag(:invitees, nil, :placeholder => "enter email address, separated by ; ") %> 
			</p>
		<p class="assign"><i></i> assign myself</p>
		
		<!-- tivit description -->
		<!-- <p><label for="what">What:</label><textarea id="what" cols="10" rows="10"></textarea></p>-->
		<p><label for="what">What:</label>
			<%= text_area_tag(:description, nil) %> 
			</p>
	
		<!-- need by date -->		  	
		<p class="input-date"><label for="due">Needed by:</label>
	     	<%= text_field_tag(:due, nil, :placeholder => "choose date", :name => "due",  :id => "due", :autocomplete => "off", :class => "input-date") %> 
	     	<img class="ico_calc" src="/images/cal.gif" onclick="javascript:NewCssCal('due', 'mmddyyyy', 'arrow')" class="ico_calc" style="cursor:pointer"/> 	
		</p>
		 	
		<div class="request">
			<div class="form-button" id="cancel">Cancel</div>
			  <%= submit_tag("Create", :class => "form-button") %>
		</div>
		
	<% end %> 
	
	<!-- Popup close button -->
	<div class="close" id="popup-close"></div>
	
</div>

<div class="activities">
	<!-- Top Activities Panel -->
	<div class="act-main">
		<div class="avatar">
			<!-- <img class="avatar" src="images/act_avatar.gif" alt="Don-profile"> -->
			<%= render :partial => 'profile_images/profile_image', :collection =>  [activitydetails.get_owner], :as => :user, :class => "avatar" %> 
			
		</div>
		<div class="info">
			
			<!-- Activity Name -->

			<h1><%= activitydetails.name %></h1>
			
			<!-- <p><small>Don Draper, Yesterday @ 8:09 AM</small></p> -->
			<p><small><%= activitydetails.get_owner.get_name %>, <%= time_ago_in_words(activitydetails.created_at) %> ago.</small></p>
			
			<!-- <p class="progress-complete"><span>20%</span> (1/5 tivits complete)</p> -->	
			<p class="progress-complete">
				<span>
					<%unless activitydetails.get_number_of_tivits == 0%>
	            		<strong> <%=(( 100 * activitydetails.get_number_of_completed_tivits) / activitydetails.get_number_of_tivits)%>%</strong>
	     
	        			</span> 
	     				(<%= activitydetails.get_number_of_completed_tivits %>/<%= activitydetails.get_number_of_tivits %> tivits completed)	
	     			   		
	        		<%end%>   
	        </p>		
			<ul>
				<li class="edit">edit</li><li class="add">add a file</li><li class="cmpl">mark as completed</li><li class="dele">delete</li>
			</ul>
		</div>
		<!-- Activity Due Date -->
		<!-- 
		<div class="calendar red">
			<div class="week">MON</div>
	    	<div class="text">26</div>
		</div>
		-->
		<div class="calendar new">
			<%if (activitydetails.due != nil && activitydetails.due.inspect.size > 0 )%>
				<div class="week"><%= (activitydetails.due.strftime ("%a")).upcase %></div>
	    		<div class="text"><%= activitydetails.due.strftime ("%d") %></div>
	    	<%end%>
		</div>
		
		<!-- Activity Description -->
		<div class="description">
			<p><%= activitydetails.description %> 
			 <a class="more" href="#">...more</a> <!-- <small>Don Drapper 5 min ago</small></p> -->
		</div>
	</div>
	

	<div class="body">
		<!-- Right col: Files -->
		<div class="rightCol files">
			<h2>files <span>(2)</span></h2>
			<div class="file new">
				<p><a href="#"><img src="../images/file_1.jpg" alt="Presentation" /></a></p>
				<p><a href="#">Kodak Competitive Lan...</a></p>
				<p><span>Pete Campbell</span></p>
				<p><small>17 minutes ago</small></p>
			</div>			
			<div class="file">
				<p><a href="#"><img src="../images/file_2.jpg" alt="Excel" /><i>3</i></a></p>
				<p><a href="#">Lucky Strike Presentation</a></p>
				<p><span>Don Draper</span></p>
				<p><small>Yesterday @ 8:09 AM</small></p>
			</div>
		</div>
	
		<!-- Left col: tivities -->		
		<div class="leftCol">
			<!-- My tivits -->
			<div class="tivits main-tivit" id="alltivits">
				<!-- <h2>my tivits <span>(1)</span></h2> -->		
				<% mytivits = activitydetails.tivits.where("owner_id = ? " ,current_account.user.id) %>
				<% if mytivits !=nil && mytivits.size > 0 %>
					<h2>my tivits <span>(<%= mytivits.size %>)</span></h2>
					<div class="tvit-list" id="mytivits">
						<%= render :partial => 'shared/tivit_adp', :collection =>  mytivits %>
					</div>
				<%end%>
				
				<!-- add tivit button -->
				
				<p><input type="submit" value="add a tivit" id="add-tivit" class="form-button"></p>
				<!-- 
				<p><%= link_to "add a tivit", 	:controller  => "activities", 
   											:action      => "new_tivit",
   											:id          => activitydetails.id, 
  							    			:title       => activitydetails.name,
  							    			:class		 => "form-button" %>
  							    			
				</p>
				-->
    					
			<!-- End of Main Tivits -->
			</div> <!-- My tivits -->
			
			<!-- Team tivits -->
		
			<div class="team tivits" id="team-tivits">
				<!-- <h2>team tivits<span>(4)</span></h2> -->
				<% teamtivits = activitydetails.tivits.where("NOT owner_id = ? " ,current_account.user.id) %>
				<% if teamtivits !=nil && teamtivits.size > 0 %>
					<h2>team tivits <span>(<%= teamtivits.size %>)</span></h2>
					<div class="tvit-list" id="teamtivits">
						<%= render :partial => 'shared/tivit_adp', :collection =>  teamtivits %>
					</div>
				<%end%>
				
			</div> <!-- team tivits -->
			
		</div> <!-- "leftCol -->
	
	</div> <!-- "body" -->
	
</div> <!--"activities" --> 


<!-- Old Activity Details Page code -->

<div id="tivit-container">

	<div id="tivit-container-background">
		
		<div class="avatar">
			 <%= render :partial => 'profile_images/profile_image', :collection =>  [activitydetails.get_owner], :as => :user%> 
		</div>


	<div id="tivit-title" class="text">
			
			<h1><%= activitydetails.name %> </h1>
		<small>by <%= activitydetails.get_owner.get_email %> </small>
		
			
			<% if activitydetails.due!=nil %>
   				<% if activitydetails.due > Time.now %>
      				<span class="timestamp">Needed by: <%= time_ago_in_words(activitydetails.due) %> </span>
   				<% else %>
   					<span class="timestamp">Activity <%= time_ago_in_words(activitydetails.due) %> ovberdue! </span>
   				<% end %>
   			<% else %>
   				<span class="timestamp">DUE DATE == Nil  </span>
   				
   			<% end %>                                                   
		</div>			
	</div>
</div>

<tr>
  <td class="activity">

    <span class="content">Summary: <%= activitydetails.description %></span><br>
    

    <span class="timestamp">tivit created <%= time_ago_in_words(activitydetails.created_at) %> ago.</span><br>
  </td>
  <td>
  	<span class="content">My status : <%= activitydetails.get_user_status(current_account.user) %>:<%= activitydetails.get_user_status_comment(current_account.user) %> </span><br> 			
   	<span class="content">Activity Status : </span> 			
   	
  	<% if activitydetails.status == "Completed" %>
 			<span class="content"> Completed !</span><br>
 			<span class="content">Tivit Summary : <%= activitydetails.summary%> </span><br> 			
   			
 			<% if activitydetails.completed_at!=nil %>
				<span class="timestamp">tivit was completed <%= time_ago_in_words(activitydetails.completed_at) %> ago </span> 			
   			<% end %> 
  	<% else %> 
 			<span class="content"> In Progress </span><br>
 			 
  	<% end %> 
   
  </td>
  
  
  <td>
  
<h1><%= link_to "Add file", 		:controller  => "documents", 
   											:action      => "new",
   											:id          => activitydetails.id, 
  							    			:title       => "Manage Files" %>,<h1>


	 	<% if activitydetails.documents == nil %>
 			<span class="content"> No file attached to this Activity</span><br>
 		<% else %>

			<%= render :partial => 'documents/document', :collection =>  activitydetails.documents %> 
 		<% end %> 
 		
  	
  
   <h1><%= link_to "Add tivit", 		:controller  => "activities", 
   											:action      => "new_tivit",
   											:id          => activitydetails.id, 
  							    			:title       => activitydetails.name %>,<h1>
	
  <% if current_account.user.id == (activitydetails.owner_id) %>
  	<%= link_to "edit", edit_activity_path(activitydetails) %>
  	
    <%= link_to "delete", activitydetails, :method => :delete,
                                     :confirm => "You sure you want to delete" +activitydetails.name+"?",
                                     :title => activitydetails.name %>                                       
    </br>                                
  <% end %>
  
  		  
  <br>
                                      
   <% if current_account.user.id != (activitydetails.owner_id) %>

<!-- this action is not working yet-->
	<%= link_to "Completed",    :controller  => "activities",
    							:action      => "change_tivit_status",
    							:status      => "Completed",
    							:id          => activitydetails.id, 
  							    :confirm     => "Are you sure you want to mark activity as completed" +activitydetails.name+"?",
                                :title       => activitydetails.name %>

  <% end %>
  
  
  </td>
</tr>
<tr>

  <td>

	
<!-- Displying list of My Tivits-->  	
 <span class="content">
 	<% mytivits = activitydetails.tivits.where("owner_id = ? " ,current_account.user.id)%>
	<% if mytivits !=nil && mytivits.size > 0%>
		<h1><%= mytivits.size %> My Tivits</span></h1>
		<%= render :partial => 'shared/tivit', :collection =>  mytivits %> 
	<%end%>

<!-- Displying list of Team Tivits-->
	
<% teamtivits = activitydetails.tivits.where("NOT owner_id = ? " ,current_account.user.id)%>
	<% if teamtivits !=nil && teamtivits.size > 0%>
		<h1><%= teamtivits.size %> Team Tivits</span></h1>
		<%= render :partial => 'shared/tivit', :collection =>  teamtivits %> 
	<%end%>
  </td>
</tr>
  