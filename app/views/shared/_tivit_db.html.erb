<!-- Display a tivit within an activity on the  Dashboard -->
<% owner_tivit_status = tivit.get_owner_status %>

<% if (owner_tivit_status == "OnIt" || owner_tivit_status == "Accepted")%>

	<li class="record inprog">
	    
<% elsif owner_tivit_status == "New" || owner_tivit_status == "Reminded" || owner_tivit_status == "Reviewed"%>

	<li class="record unread">
	                      
<% elsif owner_tivit_status == "Done" %>

	<li class="record complete">
		
<% elsif owner_tivit_status == "Proposed" %>

	<li class="record attention">

                            
<% else %>	                            

	<li class="record busy">
	
<%end%>

	<div class="status">
		<div class="icon"></div>
	</div>

<!-- if the status is new, that means the owner didn't read it yet, dim avatar and put the remind link -->
<% if owner_tivit_status == "New" || owner_tivit_status == "Reminded"%>

	<div class="avatar attention">
<% else %>
	<div class="avatar">
<%end%>
		<%= render :partial => 'profile_images/profile_image', :collection =>  [tivit.get_owner], :as => :user%> 
	</div>
	<div class="text">
		<div class="activity">
		   	<div class="attach">
		   		<i></i>
		    </div>
		    
		    <% unread_comments = tivit.get_number_of_unread_comments(current_account.user)%>
		    
		   	<div class="comments">
		   		<% if unread_comments > 0 %>
		   			<i><%=unread_comments%></i>
		   		<%end%>
		    </div>
		  	    
		</div>
		<div class="wrapp">
			<div class="twr">
	              <h3><%= tivit.name%>       
	              	
	              	<% if tivit.due != nil && tivit.due < Time.now %>
      					<span class="timestamp"> - <%= time_ago_in_words(tivit.due) %> ovberdue! </span>
   					<% end %>
	              	
	              	
	              </h3>
	              <span class="grey">
	              	<%= tivit.get_owner.get_name %>
	              	
	              	
	              	<% if !tivit.invitedByOwner?%>
	              		invited by <%=tivit.get_invited_by.get_name%>
	              		<% if owner_tivit_status != "Reminded"%>
	              			 <%= time_ago_in_words(tivit.created_at)%> ago
	              		<%end%>
							 
	              	<%end%>
					
	              	<%action = "remind"%>
					<% if owner_tivit_status == "New" || owner_tivit_status == "Reminded"%>
						
						, <b>unread</b> 
						<%if owner_tivit_status == "Reminded" %>
							<% action = "remind again" %>
							last reminded <%= time_ago_in_words(tivit.get_owner_last_status_change)%> ago
						<%end%>

						<%if((current_account.user.id == tivit.get_parent.get_owner.id && current_account.user.id != tivit.get_owner.id)|| (current_account.user.id == tivit.get_invited_by.id) )%>	              	
	              			<a>
							<%= link_to action,    :controller  => "activities",
    												:action      => "change_tivit_status",
    												:status      => "remind",
    												:id          => tivit.id, 
  							    					:confirm     => "Are you sure you want to accepet new date " +tivit.name+"?",
                                					:title       => tivit.name %>
							</a>
						<%end%>
					<% end %>
					
					
					
					
					<% if owner_tivit_status == "Proposed" %>
						, New date proposed 
						<a href=""> <%=tivit.get_owner_proposed_date%></a>
						
						<%if (current_account.user.id == tivit.get_parent.get_owner.id) %>
						<a>
						<%= link_to "Accepet",      :controller  => "activities",
    												:action      => "change_tivit_status",
    												:status      => "accept_date",
    												:id          => tivit.id, 
  							    					:confirm     => "Are you sure you want to accepet new date " +tivit.name+"?",
                                					:title       => tivit.name %>
						
						
						</a>	
						<%end%>
	              		
					<% end %>
						              	
<!-- If tivit was reviewed but no other action taken, add a comment when it was read and  -->
 
	              	<% if owner_tivit_status == "Reviewed"  && tivit.get_owner_last_review_date != nil%>
	              		<%if (current_account.user.id == tivit.get_owner.id)%>
							<b> Owner Awaiting Response </b> </br>
						<%end%>
						<a href=""> last reviewed <%= time_ago_in_words(tivit.get_owner_last_review_date)%> ago</a>
						
					<% end %>	              	
	              	
	              </span>
	         
            </div>
		</div>
	                                
		
		
	</div>
	<div class="clear"></div>
</li>
		            


